// Generated by CoffeeScript 1.8.0
(function() {
  var FileSystemObject, Promise, chai, current_new_path_methods, expect, fd_methods, fs, fso, hierarchy, single_path_methods, single_path_methods_nosync, sinon,
    __slice = [].slice;

  if (typeof require !== "undefined" && require !== null) {
    chai = require('chai');
  } else {
    chai = this.chai;
  }

  chai.should();

  expect = chai.expect;

  if (typeof require !== "undefined" && require !== null) {
    if (typeof Promise === "undefined" || Promise === null) {
      Promise = require('bluebird');
    }
    sinon = require('sinon');
    fs = require('fs');
    fso = require('../fso.js');
  } else {
    if (Promise == null) {
      Promise = this.Promise;
    }
    sinon = this.sinon;
    fs = this.fs;
    FileSystemObject = this.FileSystemObject;
    fso = new FileSystemObject(fs, process.cwd());
  }

  hierarchy = {
    'cwdfile': 'cwdfile',
    'dir': {
      'dirfile': 'dirfile',
      'dirfile2': 'dirfile2',
      'dir2': {
        'dir2file': 'dir2file',
        'dir2file2': 'dir2file2'
      },
      'dir22': {
        'dir22file': 'dir22file',
        'dir22file2': 'dir22file2'
      }
    },
    'dir1': {
      'dir1file1': 'dir1file1',
      'dir1file2': 'dir1file2'
    }
  };

  single_path_methods = ['truncate', 'chown', 'lchown', 'chmod', 'lchmod', 'stat', 'lstat', 'readlink', 'realpath', 'unlink', 'rmdir', 'mkdir', 'readdir', 'utimes', 'readFile', 'writeFile', 'appendFile', 'exists'];

  single_path_methods_nosync = ['createReadStream', 'createWriteStream'];

  current_new_path_methods = ['rename', 'link', 'symlink'];

  fd_methods = ['ftruncate', 'fchown', 'fchmod', 'fstat', 'write', 'read'];

  describe('single_path_methods', function() {
    beforeEach(function() {
      var method, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = single_path_methods.length; _i < _len; _i++) {
        method = single_path_methods[_i];
        sinon.stub(fs, method);
        _results.push(sinon.stub(fs, method + 'Sync'));
      }
      return _results;
    });
    afterEach(function() {
      var method, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = single_path_methods.length; _i < _len; _i++) {
        method = single_path_methods[_i];
        fs[method].restore();
        _results.push(fs[method + 'Sync'].restore());
      }
      return _results;
    });
    it('should do like fs', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1, (function() {})];
      _results = [];
      for (_i = 0, _len = single_path_methods.length; _i < _len; _i++) {
        method = single_path_methods[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
    it('should do like fs Promise', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1];
      _results = [];
      for (_i = 0, _len = single_path_methods.length; _i < _len; _i++) {
        method = single_path_methods[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args), [fs[method].firstCall.args[fs[method].firstCall.args.length - 1]])).should.be["true"]);
      }
      return _results;
    });
    return it('should do like fs Sync', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1, (function() {})];
      _results = [];
      for (_i = 0, _len = single_path_methods.length; _i < _len; _i++) {
        method = single_path_methods[_i];
        file[method + 'Sync'].apply(file, args);
        _results.push((_ref = fs[method + 'Sync'].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
  });

  describe('single_path_methods_nosync', function() {
    beforeEach(function() {
      var method, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = single_path_methods_nosync.length; _i < _len; _i++) {
        method = single_path_methods_nosync[_i];
        _results.push(sinon.stub(fs, method));
      }
      return _results;
    });
    afterEach(function() {
      var method, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = single_path_methods_nosync.length; _i < _len; _i++) {
        method = single_path_methods_nosync[_i];
        _results.push(fs[method].restore());
      }
      return _results;
    });
    return it('should do like fs Sync', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1, (function() {})];
      _results = [];
      for (_i = 0, _len = single_path_methods_nosync.length; _i < _len; _i++) {
        method = single_path_methods_nosync[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
  });

  describe('current_new_path_methods', function() {
    beforeEach(function() {
      var method, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = current_new_path_methods.length; _i < _len; _i++) {
        method = current_new_path_methods[_i];
        sinon.stub(fs, method);
        _results.push(sinon.stub(fs, method + 'Sync'));
      }
      return _results;
    });
    afterEach(function() {
      var method, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = current_new_path_methods.length; _i < _len; _i++) {
        method = current_new_path_methods[_i];
        fs[method].restore();
        _results.push(fs[method + 'Sync'].restore());
      }
      return _results;
    });
    it('should do like fs', function() {
      var args, file, filename, method, newfile, newfilename, _i, _len, _ref, _results;
      filename = '/file';
      newfilename = '/newfile';
      file = fso["new"](filename);
      newfile = fso["new"](newfilename);
      args = [newfile.path, 'a', 'b', [], 100, -1, (function() {})];
      _results = [];
      for (_i = 0, _len = current_new_path_methods.length; _i < _len; _i++) {
        method = current_new_path_methods[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
    it('should do like fs Promise', function() {
      var args, file, filename, method, newfile, newfilename, _i, _len, _ref, _results;
      filename = '/file';
      newfilename = '/newfile';
      file = fso["new"](filename);
      newfile = fso["new"](newfilename);
      args = [newfile.path, 'a', 'b', [], 100, -1];
      _results = [];
      for (_i = 0, _len = current_new_path_methods.length; _i < _len; _i++) {
        method = current_new_path_methods[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args), [fs[method].firstCall.args[fs[method].firstCall.args.length - 1]])).should.be["true"]);
      }
      return _results;
    });
    return it('should do like fs Sync', function() {
      var args, file, filename, method, newfile, newfilename, _i, _len, _ref, _results;
      filename = '/file';
      newfilename = '/newfile';
      file = fso["new"](filename);
      newfile = fso["new"](newfilename);
      args = [newfile.path, 'a', 'b', [], 100, -1, (function() {})];
      _results = [];
      for (_i = 0, _len = current_new_path_methods.length; _i < _len; _i++) {
        method = current_new_path_methods[_i];
        file[method + 'Sync'].apply(file, args);
        _results.push((_ref = fs[method + 'Sync'].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
  });

  describe('open', function() {
    var fd, method;
    method = 'open';
    fd = 111;
    beforeEach(function() {
      sinon.stub(fs, method, function() {
        var args, callback, _i;
        args = 2 <= arguments.length ? __slice.call(arguments, 0, _i = arguments.length - 1) : (_i = 0, []), callback = arguments[_i++];
        return callback(null, fd);
      });
      return sinon.stub(fs, method + 'Sync', function() {
        return fd;
      });
    });
    afterEach(function() {
      fs[method].restore();
      return fs[method + 'Sync'].restore();
    });
    it('should do like fs and store fd', function() {
      var args, callback, file, filename, _ref;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1];
      callback = sinon.spy();
      file[method].apply(file, __slice.call(args).concat([callback]));
      (_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args), [fs[method].firstCall.args[fs[method].firstCall.args.length - 1]])).should.be["true"];
      callback.firstCall.calledWithExactly(null, fd).should.be["true"];
      return file.fd.should.be.equals(fd);
    });
    it('should do like fs and store fd Promise', function() {
      var args, file, filename, _ref;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1];
      file[method].apply(file, args);
      (_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args), [fs[method].firstCall.args[fs[method].firstCall.args.length - 1]])).should.be["true"];
      return file.fd.should.be.equals(fd);
    });
    return it('should do like fs and store fd Sync', function() {
      var args, file, filename, _ref;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1];
      file[method + 'Sync'].apply(file, args);
      (_ref = fs[method + 'Sync'].firstCall).calledWithExactly.apply(_ref, [file.path].concat(__slice.call(args))).should.be["true"];
      return file.fd.should.be.equals(fd);
    });
  });

  describe('fd_methods', function() {
    var fd;
    fd = 111;
    beforeEach(function() {
      var method, _i, _len;
      for (_i = 0, _len = fd_methods.length; _i < _len; _i++) {
        method = fd_methods[_i];
        sinon.stub(fs, method);
        sinon.stub(fs, method + 'Sync');
      }
      return sinon.stub(fs, 'openSync', function() {
        return fd;
      });
    });
    afterEach(function() {
      var method, _i, _len;
      for (_i = 0, _len = fd_methods.length; _i < _len; _i++) {
        method = fd_methods[_i];
        fs[method].restore();
        fs[method + 'Sync'].restore();
      }
      return fs['openSync'].restore();
    });
    it('should do like fs', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      file.openSync();
      args = ['a', 'b', [], 100, -1, (function() {})];
      _results = [];
      for (_i = 0, _len = fd_methods.length; _i < _len; _i++) {
        method = fd_methods[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [fd].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
    it('should do like fs Promise', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1];
      file.openSync();
      _results = [];
      for (_i = 0, _len = fd_methods.length; _i < _len; _i++) {
        method = fd_methods[_i];
        file[method].apply(file, args);
        _results.push((_ref = fs[method].firstCall).calledWithExactly.apply(_ref, [fd].concat(__slice.call(args), [fs[method].firstCall.args[fs[method].firstCall.args.length - 1]])).should.be["true"]);
      }
      return _results;
    });
    return it('should do like fs Sync', function() {
      var args, file, filename, method, _i, _len, _ref, _results;
      filename = '/file';
      file = fso["new"](filename);
      args = ['a', 'b', [], 100, -1, (function() {})];
      file.openSync();
      _results = [];
      for (_i = 0, _len = fd_methods.length; _i < _len; _i++) {
        method = fd_methods[_i];
        file[method + 'Sync'].apply(file, args);
        _results.push((_ref = fs[method + 'Sync'].firstCall).calledWithExactly.apply(_ref, [fd].concat(__slice.call(args))).should.be["true"]);
      }
      return _results;
    });
  });


  /*
  describe 'objective', ->
  	beforeEach ->
  		mock hierarchy
  	afterEach ->
  		mock.restore()
  	it 'should do like fs Sync', ->
  		filename = 'cwdfile'
   *		file = fso.new filename
  
  cwdfile = fso.new 'cwdfile'
  console.log cwdfile.readFileSync 'utf8'
  dir = fso.new 'dir'
  console.log dir.readdirSync()
  dir.readdir (err, files) -> console.log files
  dir.new('../dir1').children()
  .then (children) ->
  	for child in children
  		console.log child.path
   */

}).call(this);
